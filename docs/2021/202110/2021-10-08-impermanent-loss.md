---
layout: post
title: "无常损失漫谈"
date: 2021-10-08 08:00:00 +0800
categories: essay
---

经过了十一期间的接连上升，比特币已经从9/30的低点4万刀附近来到了10/7最高55k附近。隔夜，市场有所回调，目前小幅回落至54k一线。满仓持币，无问西东，肺腑之言。

金九银十由此成为这样的情况：金九月的回调创造了逢跌加仓的机会，银十月的反弹才带来了盈利的回报。机会永远是跌出来的。涨出来的，只有致命的诱惑。没有践行八字诀，没有把握住金九月这一次在下半场开启之前可能是最后的加仓机会，那么往后就越来越没有那么大的促销力度和折扣价格了。

由于市场的回暖，我在Uniswap的做市资金也开始发生积极的变化。这里我们就来谈一谈Uniswap和AMM（算法自动做市商）。

基本概念我们就不再赘述了。关于Uniswap这个被视为所谓DEX（去中心化交易所）龙头，甚至是DeFi（去中心化金融）龙头的项目，此前刘教链公众号多有介绍，特别是在去年11/3两刀介入建仓的时候，写过不少的分析文章，可以翻阅参考。

DEX是一个和CEX（中心化交易所）相对的概念。在CEX里，有一个很重要的角色，就是所谓的market maker（做市商），与每一个买卖的用户做对手方，帮助你完成交易。比如，对于交易对BTC/USDT，当你买入BTC的时候，本质上是你以一个期望的比价，把一定量的USDT卖给了market maker，同时从他手里换回了对应数量的BTC。传统的market maker会在订单簿系统里分层主动挂单，以为交易用户提供流动性深度。

对于DEX，由于受到链的技术特性的制约，不能采用订单簿系统。DEX的龙头，创新引领者Uniswap开创性地采用了开放式的AMM技术，让任何人都可以把任意两种资产组成交易对，锁定在智能合约之中，然后由内置在智能合约中的算法自动为交易用户提供交易对的兑换服务。全程不需要人工干预，实现了交易的全自动化。

为Uniswap提供交易对资产，也就是提供流动性资金的人，被称之为Liquidity Provider，缩写为LP。

比如，长期关注刘教链的朋友知道，我在去年中开始研究Uniswap，11月开始投Uniswap，今年2月底开始在Uniswap里做LP（参考3/2旧文《绝地大反攻》中的记录）。

做LP这件事，乍看起来是一件不怎么划算的事情。因为你的资金一直在被动地反向交易。别人卖出的时候，你买入；别人买入的时候，你卖出。如果交易的推动者，也就是交易用户是聪明的话，那么你的反向被动交易就是愚蠢的。

的确，如果市场一直在走单边行情，以我做市的ETH/USDC为例，如果ETH的价格一直在上涨，那么AMM算法就会不断地把我的ETH卖掉，换成USDC。

Uniswap采用的是所谓恒定乘积AMM算法。假设开始我放进去10 ETH和15000 USDC，此时ETH价格是1500 USDC，二者的乘积是10 * 15000 = 150,000。

当ETH价格上涨到2000 USDC时，为了维持乘积恒定，也就是x ETH * y USDC = 150,000。我们可以轻松算出来，x = 8.66, y = 17320。也就是我的做市资金变成了8.66 ETH和17320 USDC。

ETH从10个减少到了8.66个，净减少了1.34 ETH。USDC从15000个增加到了17320个，净增加了2320 USDC。相当于我被动卖掉了1.34 ETH，换回来2320 USDC。此时我的资产总价值从10 ETH + 15000 USDC = 30,000 USDC增加到了8.66 ETH + 17320 USDC = 34,640 USDC，净赚4640 USDC。

这买卖做的划算吗？

假设我最初的10 ETH和15000 USDC不放到Uniswap里做LP，而是持有不动直至ETH上涨到2000 USDC。那么我的资产数量不变，但是资产总价值变成了10 * 2000 + 15000 = 35,000 USDC，净增加5000 USDC，比放到Uniswap做LP多赚360 USDC。

显然，经计算可知，做LP是不划算的，不如持有不动收益高。

反过来，如果币价下跌，也可以同样计算出来，LP将获得更大的亏损。因为LP会在下跌过程中被动买入跌幅最大的那个资产。

LP真的是傻瓜吗？AMM里面的资金真的是傻钱吗？刘教链公众号在6/29写过一篇文章《LP是傻瓜吗？》，对此进行了一些探讨。

做LP相对于持币而言所损失的收益，有一个术语叫做impermanent loss，直译叫做“非永久损失”，一个流行的译法叫做“无常损失”。不过我总觉得后一种意译似乎有些扭曲了英文原文的意思。

我们会看到，只要波动性发生，就会产生无常损失。但是为什么它又被称为“非永久”的呢？因为如果交易对的比价重新回到起点，比如对于上面ETH/USDC的例子而言，重新回到ETH价格1500 USDC的起点，那么无常损失就会消失。LP的收益和持有不动的收益回归相等。

但是，我们都知道，哪有两种资产的比价总是会围绕一个固定值波动的呢？更常见的情况是，两种资产各有不同的发展轨迹。总是在走不同的路，上下不同的台阶，于是就会产生实质性、近乎永久性的比价分离。这种比价的实质而永久的变动，就会把LP的无常损失变成永恒损失。

长期来看，无常损失变成永恒损失，简直是一定的。

比如ETH，随着价值的提高，会发生实质性的、阶梯式的跨越，那么当其价格水平上了一个新的台阶之后，ETH/USDC的比价就永远回不去了，一部分过早被动低价卖掉ETH而造成的无常损失就被固定下来，成为了永恒损失。

而很多空气币，随着项目的趋于失败，会发生阶梯式的、持续的下跌，当其价格水平下了一个新的台阶之后，XXX/USDC的比价也永远回不去了。它越跌，AMM越多的把USDC换成这个空气币，最后变成一手的空气币，而其价值近乎零。无常损失造成了严重损失。

因此，为了弥补LP的无常损失，Uniswap设置了交易手续费。也就是说，交易者每进行一笔交易，都要支付一部分比例的费用给LP，以补偿LP所承受的无常损失风险。对于Uniswap V2版本而言，这个费率是固定的千分之3。而对于Uniswap V3而言，则有万5、千3和千1三种费率可供LP自主选择。

对于准备做LP的人，则要想好自己的策略。

(公众号：刘教链。知识星球：公众号回复“星球”)
(免责声明：本文内容均不构成任何投资建议。加密货币为极高风险品种，有随时归零的风险，请谨慎参与，自我负责。)
