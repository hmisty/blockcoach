<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<title data-react-helmet="true">比特币的小bug：重复的币基交易 | 刘教链</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blockcoach.com/2025/202503/2025-03-27-A-duplicate-tx"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="比特币的小bug：重复的币基交易 | 刘教链"><meta data-react-helmet="true" name="description" content="周四BTC在86-87k区间横盘小幅震荡。2025年3月份眼瞅着就要过去了。3月份过去，一季度也就要结束了。正如今日3.27教链内参说的，这个一季度《或许是2018年来最差的一季度》。"><meta data-react-helmet="true" property="og:description" content="周四BTC在86-87k区间横盘小幅震荡。2025年3月份眼瞅着就要过去了。3月份过去，一季度也就要结束了。正如今日3.27教链内参说的，这个一季度《或许是2018年来最差的一季度》。"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blockcoach.com/2025/202503/2025-03-27-A-duplicate-tx"><link data-react-helmet="true" rel="alternate" href="https://blockcoach.com/2025/202503/2025-03-27-A-duplicate-tx" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blockcoach.com/2025/202503/2025-03-27-A-duplicate-tx" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.18f1df96.css">
<link rel="preload" href="/assets/js/runtime~main.f3b16f89.js" as="script">
<link rel="preload" href="/assets/js/main.e08f0718.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Blockcoach Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/favicon.ico" alt="Blockcoach Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">刘教链</b></a><a class="navbar__item navbar__link navbar__link--active" href="/intro">文集</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/intro">intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/2020/202012/2020-12-30-debate-btc-no-value">2020</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/2021/202101/2021-01-02-2020-review">2021</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/2022/202201/2022-01-01-wonderful-2022">2022</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/2023/202301/2023-01-01-time-flies-2022">2023</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/2024/202401/2024-01-01-A-10yrs12B-happy-new-year">2024</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/2025/202501/2025-01-01-A-10yrs12B">2025</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/2025/202501/2025-01-01-A-10yrs12B">202501</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/2025/202502/2025-02-01-A-10yrs1B-ollama-deepseek">202502</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/2025/202503/2025-03-01-A-10yrs2B">202503</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-01-A-10yrs2B">[十年之约.42] 脱离</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-02-A-meaning-of-hodl">持仓的意义</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-03-A-deep-v-reverse">深V反转背后的精准开单和拉高出货</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-04-A-vicious-manipulator">恶庄凶猛</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-05-A-artificial-recession">人造衰退</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-06-A-scheme-and-plan-of-strategic-reserve">战略储备的阴阳谋</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-07-A-such-a-strategic-reserve">竟是这样的加密战略储备</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-08-A-fiat-or-coin-standard">币本位和金本位</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-09-A-10yrs3A">十年之约系列(43)：透心凉</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-10-A-down-to-70k">跌到7万又如何</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-11-A-bull-turns-around">千金难买牛回头</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-12-A-big-liquidation">大爆仓</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-13-A-bear-appears">币市熊出没</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-14-A-repaire-roof">下次，记得在阳光灿烂的日子修屋顶</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-15-A-choice-z">选项Z</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-16-A-why-cold-wallet-stolen">冷钱包为何被盗</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-17-A-slow-bull">慢牛</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-18-A-bsc-meme">醉翁之意不在酒</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-19-A-notitle">降息陷阱</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-20-A-fed-eats-uncooked-rice">美联储吃下夹生饭</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-20-A-sec-pow-is-not-security">SEC为比特币挖矿正名</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-22-A-oversold-period">超卖时间</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-23-A-unbelievers-never-believe">不信者恒不信</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-24-A-fault-tolerance">做高容错性投资</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-25-A-central-track-hesitation">中轨彷徨</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-26-A-how-much-btc-fire">存够几个BTC就敢主动失业？</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/2025/202503/2025-03-27-A-duplicate-tx">比特币的小bug：重复的币基交易</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/2025/202503/2025-03-28-A-decentralize-power">去中心化分权再探讨</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/manual/howto-oversea-appleid">manual</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="theme-doc-markdown markdown"><header><h1>比特币的小bug：重复的币基交易</h1></header><p>周四BTC在86-87k区间横盘小幅震荡。2025年3月份眼瞅着就要过去了。3月份过去，一季度也就要结束了。正如今日3.27教链内参说的，这个一季度《或许是2018年来最差的一季度》。</p><p>时光如水，岁月如歌。BTC就是时光奏响的乐章。但是在早年，具体说来是2013年之前，乐章中出现了一些不和谐的音符。这些不和谐的音符，就是重复的币基交易（铸币交易）。</p><p>所谓币基交易（铸币交易），又称 coinbase交易，是BTC每个新生成的区块中的第一条交易。挖到该区块的矿工通常会使用这笔交易把区块奖励发送到自己的地址里去。</p><p>众所周知，BTC的普通交易是不能重复的。因为普通交易都必须花费已经存在的一笔交易的未花费的输出，即所谓UTXO，教链将其比作“硬币”，这些硬币各不相同，因此各笔花费这些硬币的交易肯定也各不相同。如果一个硬币被两笔交易给花费了，那就成了所谓“双重花费”（double-spending），这是BTC严格禁止的。</p><p>但是，一个例外出现了。那就是币基交易。币基交易是铸币交易，所以不需要花费UTXO硬币，而是可以直接从空气中创造出新的BTC来，以此作为发给矿工的奖励。</p><p>如果一个矿工接连挖到了多个区块，并且在构造币基交易数据的时候，使用了完全相同的信息，比如接收地址和其他附加信息等，那么就可能构造出完全相同的两笔交易出来。体现在区块链就是这两笔位于不同区块内的币基交易，却拥有着相同的交易数据和哈希值。</p><p>这就是重复的币基交易。</p><p>这个比特币的bug真实存在。以下就是两个真实例子，大家可以打开BTC的任意区块链浏览器验证：</p><p>区块高度91812和区块高度91842，拥有哈希值完全相同的两笔币基交易。</p><p>区块高度91722和区块高度91880，拥有哈希值完全相同的两笔币基交易。</p><p>好消息是，从未有人利用这种重复的币基交易，花费它们，构造出同样是相同的后续普通交易，从而污染整个UTXO空间。在2012年3月15号通过一次软分叉实施了BIP-30之后，这种重复的交易就不能被使用了。</p><p>更进一步的，2013年3月又激活了BIP-34软分叉，给币基交易的构造中添加了区块高度信息作为“版本号”，从而使得币基交易的哈希值不可能再重复了。</p><p>具体的，从技术细节上，是在币基交易的scriptSig开头添加区块高度，第一字节是区块高度数值的字节数——目前是0x03，意思是后续3个字节表示本币基交易所在区块高度。币基交易里的这个scriptSig又被称为coinbase script，是矿工可自由自定义的字段，早期允许写入任意数据，比如中本聪就是在这个字段写入《泰晤士报》标题的。</p><p>对比一下更直观些。我们先来看下出现重复币基交易问题的区块#91812的币基交易的scriptSig是：0456720e1b00（OP_PUSHBYTES_4 56720e1b OP_0）。</p><p>而教链现在写这篇文章时刚刚产出的一个区块#889678的币基交易scriptSig则是：034e930d044260e5672f466f756e6472792055534120506f6f6c202364726f70676f6c642f23648154608b150000000000（OP_PUSHBYTES_3 4e930d OP_PUSHBYTES_4 4260e567 OP_PUSHBYTES_47）。</p><p>开头是0x03，后续三个字节是43930d，表示其所在区块高度是十六进制的0x0d934e，即十进制的889678。</p><p>坏消息是，在2013年修复之前，已经生成的币基交易中，也有一些它们的scriptSig开头碰巧是0x03！这就让未来这些当年的矿工有可能利用这一点来故意构造重复的币基交易。</p><p>举个具体的例子吧。区块#164384的coinbase script就是0x03开头的：03d6441e014b0136（OP_PUSHBYTES_3 d6441e OP_PUSHBYTES_1 4b OP_PUSHBYTES_1 36）。</p><p>我们不知道当时这位矿工写的这个脚本是何用意。但是我们可以知道的是，他有机会利用这个漏洞，在未来尝试构造出与之完全相同的币基交易出来。</p><p>具体是什么时间呢？我们需要简单推算一下。</p><p>根据BIP-34的定义，0x03后面3个字节表示区块高度。对上面这个例子而言就是d6441e，也就是十六进制的0x1e44d6，即十进制的1983702。</p><p>而区块#1983702大概会在什么时间产出呢？根据BTC大约每10分钟产出一个区块，很容易推算出，从现在的区块#889678到未来的#1983702，还需 (1983072 - 889678)/6/24/365 = 20.8年，也就是大约2046年的时候。</p><p>坏消息是，这样的区块还有不少。下面是全表：</p><p>block_height,coinbase_height,equal
164384,1983702,TRUE
169895,3708179,TRUE
170307,3709183,TRUE
171896,3712990,TRUE
172069,3713413,TRUE
172357,3714082,TRUE
172428,3714265,TRUE
174151,5208854,TRUE
176684,490897,TRUE
183669,3761471,TRUE
196988,4275806,TRUE
201577,5327833,TRUE
206039,7299941,TRUE
206354,7299941,TRUE
209920,209921,TRUE</p><p><img src="/assets/images/2025-03-27-A01-3729370d6b4cccca3b3387947f7bbe7d.jpg"></p><p>从上面柱状图可以看出，2078年左右是风险最多的时间。</p><p>好消息是，在目前很大、未来更大的全网算力下，就算当年的矿工有这想法，它也很难刚好抢到那个高度的那个区块的打包权（生成权、挖矿权）。</p><p>而且，矿工得有多吃饱了撑的，才会去用费劲抢到挖矿权，构造一笔再也不能花掉的、模仿早年数据的交易，从而让自己白白遭受损失呢？</p><p>因此，结论就是，重复的币基交易这个bug，不能说已经被100%完美解决，但也不太可能掀起什么大的浪花。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2025/202503/2025-03-26-A-how-much-btc-fire"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">存够几个BTC就敢主动失业？</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2025/202503/2025-03-28-A-decentralize-power"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">去中心化分权再探讨</div></a></div></nav></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 刘教链</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f3b16f89.js"></script>
<script src="/assets/js/main.e08f0718.js"></script>
</body>
</html>